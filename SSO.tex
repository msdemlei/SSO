\documentclass[11pt,a4paper]{ivoa}
\input tthdefs

\usepackage[textsize=small]{todonotes}
\setlength{\marginparwidth}{3.5cm}

\usepackage{listings}
%\lstloadlanguages{sh,make,xml,[latex]tex}
\lstset{flexiblecolumns=true,numberstyle=\small,showstringspaces=False,
  identifierstyle=\texttt,defaultdialect=[latex]tex,language=tex}


\title{IVOA Single-Sign-On Profile: Authentication Mechanisms}

\ivoagroup{http://www.ivoa.net/twiki/bin/view/IVOA/IvoaGridAndWebServices}

%\author[????URL????]{http://www.ivoa.net/twiki/bin/view/IVOA/IvoaGridAndWebServices}
\author{Giuliano Taffoni}
\author{Andr\'e Schaaff}
\author{Guy Rixon}
\author{Brian Major}
\author{Patrick Dowler}
\author{Mark Taylor}

\editor{Sara Bertocco}

\previousversion[http://www.ivoa.net/documents/SSO/20160930/index.html]{WD-20160930}
\previousversion[http://www.ivoa.net/Documents/cover/SSOAuthMech-20080124.html]{REC-1.01}
\previousversion[http://www.ivoa.net/documents/cover/SSOAuthMech-20070904.html]{PR-20070904}
\previousversion[http://www.ivoa.net/documents/cover/SSOAuthMech-20070621.html]{PR-20070621}
\previousversion[http://www.ivoa.net/documents/cover/SSOAuthMech-20060519.html]{WD-20060519}


\begin{document}
\begin{abstract}
%[old begin]
%Approved client-server authentication mechanisms are described for the
%IVOA single-sign-on profile:
%No Authentication; HTTP Basic Authenti-
%cation; TLS with passwords; TLS with client certificates; Cookies; Open
%Authentication; Security Assertion Markup Language; OpenID. Normative
%rules are given for the implementation of these mechanisms, mainly by ref-
%erence to pre-existing standards. The Authorization mechanisms are out of
%the scope of this document.
%[old end]

A description is given of how an existing standard should be applied
in an IVOA application to support single sign-on capabilities.
Approved authentication mechanisms for use in the IVOA-SSO are listed
referring to existing security standards (i.e. IETF's) and the
authentication process through an IVOA challenge-response
authentication protocol is detailed.
\end{abstract}

\section*{Acknowledgments}

This document derives from discussions among the Grid and Web Services
working-group of IVOA. It is particularly informed by prototypes built
by Matthew Graham (Caltech/US-NVO), Paul Harrison (ESO/EuroVO), David
Morris (Cambridge/AstroGrid), Raymond Plante (NCSA/US-NVO) Brian Major
and  Donovan Patrick Dowler (CADC) and Giuliano Taffoni (INAF-VObs.it).
The prior art for the use of proxy certificates comes from the Globus
Alliance.
This document has been developed with support from the National Science
Foundation's Information Technology Research Program  with The Johns
Hopkins University, from the UK Particle Physics and Astronomy Research
Council (PPARC) and from the European Commission's Work programme FP7
via the  CoSADIE project and the H2020 via the ASTERICS project.


\section*{Conformance-related definitions}
The words ``MUST'', ``SHALL'', ``SHOULD'', ``MAY'', ``RECOMMENDED'', and
``OPTIONAL'' (in upper or lower case) used in this document are to be
interpreted as described in IETF standard, \citet{std:RFC2119}.

The \emph{Virtual Observatory (VO)} is
general term for a collection of federated resources that can be used
to conduct astronomical research, education, and outreach.
The \href{http://www.ivoa.net}{International
Virtual Observatory Alliance (IVOA)} is a global
collaboration of separately funded projects to develop standards and
infrastructure that enable VO applications.


\section{Introduction}

IVOA's single-sign-on architecture is a system in which users,
authenticated through existing security standards (i.e. IETF's), assign
cryptographic credentials to user agents so that the agents may act with
the user's identity and access rights.

This IVOA standard describes
%\begin{itemize}
%    \textcolor{red}{Editor's note: should be removed? Need confirmation.
%    \item describes how an existing standard should be applied in an IVOA
%    application to support single sign-on capabilities;
%    \item gives a description of}
         \begin{itemize}
              \item how clients can discover and use authentication
                    mechanisms supported by a service
             \item how services advertise their support of those
                    authentication mechanisms
	     \item how an existing standard should be applied in an IVOA
              application to support single sign-on capabilities
              %\item how agents use those credentials to authenticate
              %the user's identity in requests to services
              \item the authentication mechanism of an application or
              a service making a call (on behalf of someone or something
              else) to an API or to another service
          \end{itemize}
%\end{itemize}
In the following sections, we
make specific references to details spelled out in the
existing security standards (i.e. IETF's). For
the purposes of validating against one of these standards, those
referenced
documents should be consulted for a full explanation of details.

Each major section is concluded by a Commentary subsection that provides
some explanations of the detailed terms and concepts being referred to.
The Commentary subsection may also provide recommended scenarios for how
this specification might actually be realised. The statements
in the Commentary subsections are non-normative and should not be
considered part of precise specification; nevertheless, they are
indicative of the intended spirit of this document.

%For the purposes of validating against
%those standards, those referenced documents should be consulted for a
%full explanation of authentication process details.

\subsection{Role within the VO Architecture}

\begin{figure}
\centering

% Get the architecture diagram from the TCG chair
% http://wiki.ivoa.net/twiki/bin/view/IVOA/IvoaTCG
% If they give you a PDF, for now dumb it down to a png by
% convert -antialias -density 72x72 archdiag.pdf archdiag.png
% Oh -- Notes don't need this; you'd have to remove archdiag.png
% from FIGURES in the Makefile, too.
\includegraphics[width=0.9\textwidth]{SSO_image001.png}
\caption{Architecture diagram for this document}
\label{fig:archdiag}
\end{figure}

Fig.~\ref{fig:archdiag} shows the role this document plays within the
IVOA architecture \citep{2010ivoa.rept.1123A}.

\section{Authentication Mechanisms}
\label{sec:authentication-mechanisms}

The following authentication mechanisms are approved\todo{It would be
good if we had an operational definition for what ``approved'' means.} for use in
the IVOA-SSO profile.
\begin{itemize}
\item No authentication required.
\item HTTP Basic Authentication
\item Transport Layer Security (TLS) with passwords.
\item Transport Layer Security (TLS) with client certificates.
\item Cookies
\item Open Authentication 2.0 (OAuth) based
\item Security Assertion Markup Language (SAML)
\item OpenID Connect (OIDC)
\end{itemize}

The authentication mechanism is associated with the interface provided
by the service
%and registered in the IVOA registry.
and advertised through the mechanism described in
section \ref{sec:auth_discovery}, ``Authentication Discovery''.
Interfaces by which a user logs in to the SSO system SHALL support
either
TLS with client certificates, or TLS with passwords, or SAML,
or OAuth, or OpenID Connect or a combination of them.
Services \textcolor{red}{MAY} be registered with an IVOA registry
as having a {\em WebService} type interface\todo{WebService is dead.
Let's drop this or generalise this to other interface types} (as
described in the VOResource document) SHALL support OAuth, or SHALL
support cookies or SHALL support TLS with client
certificates or SHALL require no authentication.

\section{Authentication Process}
\label{sec:auth_discovery}

The authentication mechanisms listed in section
\ref{sec:authentication-mechanisms}, ``Authentication Mechanisms'',
can be used in different ways. Most of them are intended to
be used in an HTTP browser environment and, when they are used this
way, they can be used exactly as their associated specifications
dictate, including how to discover their support. The discovery is
performed interactively by end users.
However, to support non-browser clients
(standalone applications and command line tools), a challenge-response
authentication protocol\footnote{Challenge-response authentication is
a family of protocols in which one party presents a question
(``challenge'') and another party must provide a valid answer
(``response'') to be authenticated.
\url{https://en.wikipedia.org/wiki/Challenge-response_authentication}.
Last visited April 30, 2024} \textcolor{red}{SHOULD
(or MUST?)} be used implementing the procedures described in
the following subsection \ref{sec:bootstrapping-challenge}
``Bootstrapping and IVOA challenge-response protocol''. These procedures
allow to programmatically and interoperably discover and use the
authentication mechanism associated to a service or application. They
are extensions to the existing standards and are built upon HTTP
standards themselves.

\subsection{Challenge-response authentication}
\label{challenge-response-auth}
The challenge-response mechanism is a method used in authentication
protocols to verify the identity of a user or system. It involves the
exchange of challenges and responses between the verifier (typically a
server) and the entity being authenticated (the client).

\subsubsection{Bootstrapping and IVOA challenge-response protocol}
\label{sec:bootstrapping-challenge}
When a client contacts a service (or application), first it has the need
to know if there is \emph{optional}, \emph{required}, or \emph{no}
authentication.
For clients to initially find the level of authentication (i.e., to
bootstrap), they can make anonymous HTTP GET or HTTP HEAD requests to
the service's /capabilities endpoint as specified in VOSI, the
VO Support Interfaces \citep{2017ivoa.spec.0524G}.
Services that support one of the approved authentication mechanisms in the section
\ref{sec:authentication-mechanisms} \textcolor{red}{SHOULD or MUST?}
advertise this through the use of \emph{www-authenticate} HTTP response
header, as defined by RFC 7235 \citep{std:RFC7235}. The basic form of this
header is:

\begin{verbatim}
www-authenticate: {auth-scheme} {scheme-specific-params}
\end{verbatim}

Where \emph{auth-scheme} is a reference to the authentication mechanism,
and \emph{scheme-specific-params} conveys service-specific details on
the use of the identified authentication mechanism. For example:
\begin{verbatim}
www-authenticate: ivoa_bearer standard_id="value", access_url="value"
\end{verbatim}
with
\begin{verbatim}
standard_id="ivo://ivoa.net/sso#tls-with-password"
access_url="https://example.org/login"
\end{verbatim}
The \emph{scheme-specific-params} contains two standard
parameters:
\begin{itemize}
\item{\emph{standard\_id}} - Containing the SecurityMethod
\textcolor{red}{Editor's note:
propose to maintain the name}, i.e. one of the authentication mechanisms
outlined in section \ref{sec:authentication-mechanisms} of this
document,
``Authentication Mechanisms''.  It describes how to
obtain the credentials. Clients, for example, can obtain tokens
according to the rules for that standard ID.
\item{\emph{access\_url}} - Describes where to obtain the credentials.
It is the URL to use in the challenge-response process.
\end{itemize}

The above www-authenticate challenges can be returned in any response
to /capabilities endpoint of a service, but
typically in responses with status code 200 (Successful HTTP request), 401
(Unauthorized), or 403 (Forbidden). Meaning:

\begin{itemize}
\item{\emph{200}} with no www-authenticate headers: anonymous access only
(no authentication)
\item{\emph{200}} with www-authenticate headers: authentication optional
\item{\emph{401}} with www-authenticate headers: authentication required
\end{itemize}

Any endpoint can respond with those challenges also
if something changes, for example, after a token expires, or if an
attempt to  access to a protected resource is made.

\textcolor{red}{[Editor's note: two changes to VOSI are required: 1) VOSI augmented to
require http HEAD support for /capabilities endpoints, and 2) Modify
VOSI to allow /capabilities to respond with 401 (or 403) (also affects
TAP 1.1 sec 2; \&\ others?)]}

\subsubsection{List of approved authentication mechanisms and the
corresponding identifiers (SecurityMethods)}

The approved authentication mechanisms and the corresponding
\xmlel{SecurityMethod}  to implement is
listed in the table \ref{table:1}.

\begin{table}[th]
\begin{tabular}{p{0.33\textwidth}p{0.60\textwidth}} \sptablerule
\textbf{SSO mechanism}&\textbf{\xmlel{<securityMethod>}}\\ \sptablerule
 HTTP Basic Authentication &
\xmlel{ivo://ivoa.net/sso\#BasicAA}\\
TLS with password &  \xmlel{ivo://ivoa.net/sso\#tls-with-password} \\
TLS with client certificate & \xmlel{ivo://ivoa.net/sso\#tls-with-certificate} \\
Cookies & \xmlel{ivo://ivoa.net/sso\#cookie} \\
Open Authentication & \xmlel{ivo://ivoa.net/sso\#OAuth} \\
SAML &  \xmlel{ivo://ivoa.net/sso\#saml2.0} \\
OpenID &  \xmlel{ivo://ivoa.net/sso\#OpenID} \\
\sptablerule
\end{tabular}
\caption{List of SecurityMethods (corresponding of standard\_id(s)) for
accepted authentication methods. }
\label{table:1}
\end{table}

\subsubsection{List of challenges recognized by the IVOA and their
meanings}
Multiple challenges may be in a service's
response and clients can choose whichever one they understand or
prefer to perform the authentication operation.

\textcolor{red}{[Editor's note: Past version was: The order of the
\xmlel{securityMethod} elements determines the priority
of the method to use.  In the example above, the preferred method to
access the service is  {\em SAML}, then {\em cookies}, and finally, if
the others are not available, {\em OpenID}.}

\textbf{bearer} - The OAuth2 \citep{std:RFC6749} challenge for a Bearer
token. It means one can authenticate with a Bearer token, but does not
communicate the details of how such tokens can be obtained.

\textbf{ivoa\_bearer} - The ivoa\_bearer challenge also means that one
can authenticate with an OAuth2 bearer token, but will also include
details on obtaining such tokens through the two parameters,
\emph{standard\_id}, and \emph{access\_url}.

\textbf{ivoa\_x509} - The ivoa\_x509 challenge is an indication that you
can authenticate with an X.509 client certificate (including self-signed
proxy certificates). There are two variants: one with the two
parameters, \emph{standard\_id}, and \emph{access\_url}, and one
without. The
one with parameters tells the clients they can get an acceptable client
certificate via the described mechanism. (For sites that provide their own
certificates through their own certificate authority.) The second,
without params, says that the service accepts client certificates from
external certificate authorities.

\textbf{ivoa\_cookie} - The ivoa\_cookie challenge also means that one can
authenticate with an HTTP Cookie, and may also include details on
obtaining cookies through the two parameters, \emph{standard\_id}, and
\emph{access\_url}.

\textbf{ivoa\_saml} - The ivoa\_saml is an indication that you
can authenticate through an Identity Provider supporting the SAML
protocol.


\textbf{ivoa\_oauth} - The ivoa\_oauth \textcolor{red}{Sara's note:
OAuth is an authorization protocol and should be removed}

\textbf{ivoa\_openid} - The ivoa\_openid is an indication that you
can authenticate is an indication that you
can authenticate through OpenID Connect (OIDC), is an identity
authentication protocol that is an extension of open authorization
(OAuth) 2.0 to standardize the process for authenticating and authorizing
users when they sign in to access digital services.

\subsection{Checking Authentication}

Clients can also check current credentials with an HTTP HEAD call to
/capabilities and then look for the header \emph{x-vo-authenticated} in
the response. If present, it means that the service recognized it as an
authenticated call.  The value of this header should identify the user,
such as the user's username, or X.509 distinguished name.  The scope of
the uniqueness of this value is undefined.

Services may choose to include the x-vo-authenticated header in all
requests (not just to /capabilities) made where user authentication was
successful.

\subsection{SecurityMethod}

\textcolor{red}{[Editor's note: Should this section remain? Sara: I
think yes, see the proposed fitting with the new version of the
document]}

When a service is registered in an IVOA registry, that service's
resource document MAY include metadata expressing conformance to one or
more of the authentication mechanisms approved in the IVOA-SSO profile
(i.e. an XML element
of type \xmlel{SecurityMethod} as specified in the XML schema for
VOResource \citep{2018ivoa.spec.0625P}).
The value of the element \xmlel{SecurityMethod}
distinguishes the authentication mechanism using the values stated in
the table  \ref{table:1}.
Such a service SHOULD implement those mechanisms as described in this
document, and clients of the service MUST participate in the mechanism
when calling the service.
\textcolor{red}{Editor's note: Suppress the sentence ``If a service does
not provide any SSO specification it is assumed that no authentication
is required.'' The registration of the supported authentication
mechanism is not mandatory, the client has to call the /capability
end-point of the service to know if and which authentication method is
supported} The declaration of the supported authentication mechanism in
the service registration is not mandatory, the client has to call the
\emph{/capability} end-point
of the service to know if and which authentication method is supported
\textcolor{red}{Editor's (Sara) note: the following must be confirmed:
they MAY use either the IVOA-standard mechanisms or
others that are not IVOA standards, but they MUST answer with the
challenge described in section \ref{sec:bootstrapping-challenge}
``Bootstrapping and IVOA challenge-response protocol''.}

\subsection{Commentary}
The IVOA SSO profile allows the development of a ``realm'' of
interoperable services and clients.
Service providers opt in to this realm by implementing this current
standard.
%and by registering accordingly in the IVOA registry.
The IVOA challenge-response authentication mechanism allows clients to
know if a service is secured and to be able to use it without
being customized for the details of the specific service.

Services within the Virtual Observatory that are not intended to be
widely interoperable need not opt in to the SSO realm.
In particular, ``private'' services, accessed by web browsers and
protected by passwords, are allowed.
However, these private services SHOULD be reworked to follow the IVOA
standard if they are later promoted to a wider audience.


\section{Authentication mechanisms implementation and usage examples in
IVOA framework}

Approved authentication mechanisms are briefly introduced with reference
documents and usage examples in the IVOA framework. Some useful hints
are added.

\subsection{HTTP Basic Authentication}
\subsubsection{Requirements}
Services using HTTP basic authentication SHALL use the authentication
mechanism described in the RFC7235 \citep{std:RFC7235}
that updates RFC2617 \citep{std:RFC2617}.
Interfaces using this mechanism SHOULD respond to a call to the
\emph{/capabilities} endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_bearer
                    standard_id="ivo://ivoa.net/sso#BasicAA",
                    access_url="https://example.org/login"
\end{verbatim}
\noindent and optionally they MAY be registered with the security
method

 \texttt{ivo://ivoa.net/sso\#BasicAA}

\subsubsection{Commentary}
HTTP provides a simple challenge-response authentication framework that
can be used by a server to challenge
a client request and by a   client to provide authentication
information.
The HTTP authentication framework does not define a single mechanism for
maintaining the confidentiality of credentials.
HTTP depends on the security properties of the underlying transport or
session-level connection to provide
confidential transmission of the header fields. Connection secured with
TLS are RECOMMENDED prior to exchanging any credentials.

The ``HTTP basic authentication'' SHOULD be used with particular
attention as sensible
information (password) are sent over the wire in base64 encoding (which
can be easily converted to plaintext), which clearly incurs a
significant risk that credentials leak.

\subsection{Details of TLS}
\subsubsection{Requirements}
Services using Transport Layer Security (TLS) SHALL do so according to
the TLS v1.2 standard RFC5246 \citep{std:RFC5246}.

\subsubsection{Commentary}
TLS supersedes the Secure Sockets Layer which is an outdated
cryptographic protocol.
TLS v1.0 was based on SSL v3.0; the current version of TLS is V1.2
described in by \citet{std:RFC5246}.
TLS v1.2 is backward compatible with TLS v1.0, TLS v1.1 and SSL v3.0.
``TLS versions 1.0, 1.1, and 1.2, and SSL 3.0 are very similar, and use
compatible ClientHello messages;
thus, supporting all of them is relatively easy.[...] TLS 1.2 clients
that wish to support SSL 2.0 servers MUST
send  version 2.0 CLIENT-HELLO messages defined in SSL2.''
\citep{std:RFC5246}.

\subsection{Details of TLS-with-client-certificate}
\subsubsection{Requirements}
Certificates SHALL be transmitted and checked according to the TLS v1.2
standard RFC5246.

Services implementing TLS MUST support certificate chains including
proxy certificates according to RFC 6818  \citep{std:RFC6818}.

There are two variants of interfaces using this mechanism:
\begin{enumerate}
\item with the two
parameters, \emph{standard\_id}, and \emph{access\_url} tells the
clients they can get an acceptable client
cert via the described mechanism. For sites that provide their own
certificates through their own certificate authority. In this case,
interfaces SHOULD respond to a call to the
/capabilities endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_x509
          standard_id="ivo://ivoa.net/sso#tls-with-certificate",
          access_url="https://ra.org"
\end{verbatim}
\item without params, says that the service accepts client certificates
from external certificate authorities. In this case,
interfaces SHOULD respond to a call to the
\emph{/capabilities} endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_x509
          standard_id="ivo://ivoa.net/sso#tls-with-certificate"
\end{verbatim}
\end{enumerate}

Interfaces using this mechanism, optionally, \textcolor{red}{MAY} be
registered with the security method

\texttt{ivo://ivoa.net/sso\#tls-with-certificate}

\subsubsection{Commentary}
When Mutual Certificate Authentication is configured for REST services,
both the client and the service perform
identity verification or authentication through X.509 certificates.

The client authenticates the service during the initial SSL handshake,
when the server sends the client a certificate to authenticate itself.

\subsection{Details of TLS-with-password}
\subsubsection{Requirements}
The username and password SHALL be passed in the message protected by
the TLS mechanism, and, with a valid password credential, a Bearer token
SHALL be returned, also protected by the TLS mechanism.

The HTTP POST form parameters to be used in tls-with-password are:
\paragraph{username} - The username to use for login
\paragraph{password} - The password to use for login

When valid credentials (username and password) are used, the service
responses with a 200 response code and uses the \emph{x-vo-bearer}
response header to return an OAuth2 Bearer token.  For example:

\begin{verbatim}
curl -d 'username={userid}' -d 'password={password}' https://example.org/login
< http/1.1 200
< x-vo-authenticated: {userid}
< x-vo-bearer: {token}
\end{verbatim}

When invalid credentials are used, the service responds with a 401 code
response with www-authenticate headers: invalid username or password
and optional message in the response body. For example,

\begin{verbatim}
curl -d 'username={userid}' -d 'password={password}' https://example.org/login
< http/1.1 401
< www-authenticate: invalid username or password
\end{verbatim}

Interfaces using this mechanism SHOULD respond to a call to the
\emph{/capabilities} endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_bearer
                    standard_id="ivo://ivoa.net/sso#tls-with-password"
                    access_url="https://example.org/login"
\end{verbatim}

\noindent and optionally, \textcolor{red}{MAY} be  registered with the security
method MAY be registered with the security
method

 \texttt{ivo://ivoa.net/sso\#tls-with-password}

\subsubsection{Commentary}
``HTTP basic authentication'' passes the username and password in the
HTTP headers,
assuming that the credentials are not a natural part of the message
body. This standard applies the TLS-with-password mechanism only to the
special case of logging in to the SSO realm.
Hence, the user-name and password are logically part of the message
body, not the message header.

\subsection{The use of Cookies}
\subsubsection{Requirements}
Cookie-Based Authentication uses server side cookies to authenticate the
user on every request.
The way to manage  cookies for authentication is described in RFC 6265
\citep{std:RFC6265}.

Interfaces using this mechanism SHOULD respond to a call to the
\emph{/capabilities} endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_cookie
                    standard_id="ivo://ivoa.net/sso#cookie"
\end{verbatim}

\noindent and optionally, \textcolor{red}{MAY} be registered with the security
method

\texttt{ivo://ivoa.net/sso\#cookie}


\subsubsection{Commentary}
RESTful web services MAY support session-based authentication, either
by establishing a session token via a POST or
by using an API key as a POST body argument or as a cookie.
User-names, passwords, session tokens, and API keys SHOULD not appear in
the URL,
as it is likely to be recorded in web server logs.

\begin{figure}
\centering
\includegraphics[width=0.9\textwidth]{SSO_image002.png}
\caption{Simplified picture of SAML 2.0 authentication.}
\label{fig:saml}
\end{figure}

\subsection{Details on SAML authentication}
\subsubsection{Requirements}
Services using SAML authentication mechanisms SHALL do so according to
the
saml-core-2.0-os OASIS standard \citep{std:SAML}.
SAML includes protocols and protocol bindings and security
\citep{std:SAMLB}.

Interfaces using this mechanism SHOULD respond to a call to the
\emph{/capabilities} endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_saml
                    standard_id="ivo://ivoa.net/sso#saml2.0"
                    access_url="https://example.org/login"
\end{verbatim}

\noindent and optionally, \textcolor{red}{MAY} be registered with the security
method

\texttt{ivo://ivoa.net/sso\#saml2.0}


\subsubsection{Commentary}
SAML presumes two primary roles in any transaction: the organisation
where the identity is established,
known as the Identity Provider (``IdP''), or Asserting Party (``AP'');
and the organisation which (for this transaction) wants to use this
identity, known as the Service Provider (``SP''),
or Relying Party (``RP'').

A user attempts to access an application with the Service Provider.
The SP needs to establish the identity of this user, and so, sends an
authentication request to the Identity Provider.

The user authenticates with the IdP (IdP is taking care of the
authentication mechanisms and protocols e.g. Kerberos, LDAP, etc.) so the
IdP can send back an `Assertion' to the SP.
Now the SP knows who the user is, and can process that user accordingly
(see Fig.~\ref{fig:saml}).
\begin{figure}
\centering
\includegraphics[width=0.9\textwidth]{SSO_image003.png}
\caption{Simplified picture of OAuth 2.0 authentication.}
\label{fig:oauth}
\end{figure}

SAML2.0 protocol allows also to implement authentication service
discovery mechanisms. SAML2.0  defines a browser-based protocol
by which a centralized discovery service can provide a requesting
service provider with the unique identifier of an
IdP that can authenticate the user.

The OAuth 2.0\todo{This text seems to be a dupe of the opening of the
next chapter?} specification defines a delegation protocol that is useful
for conveying authorization decisions across a network of web-enabled
applications and APIs. OAuth is used in a wide variety of applications,
including providing mechanisms for user authentication.

The OAuth 2.0 specification defines a delegation protocol that is
useful for conveying authorization decisions across a network of
web-enabled applications and APIs. OAuth is used in a wide variety
of applications, including providing mechanisms for user authentication.

\subsection{Details on OAuth based authentication}
\textcolor{red}{Sara's note: must well specify that OAuth2 is not an
authentication protocol. It is a base for authentication tasks.}
\subsubsection{Requirements}
The OAuth 2.0 specification defines a \emph{delegation}
protocol that is useful for conveying authorization decisions across a
network of web-enabled applications and APIs. OAuth is used in a wide
variety of applications, including providing mechanisms for user
authentication but it is not an authentication protocol\footnote{
Authentication is the process of verifying a claimed identity of a
user, device, or other entity in a computer system.  It means
confirming that a user or client is who he says he is and a full
authentication protocol generally includes a number of attributes
about the user (i.e. a unique identifier, an email address, etc.).
Authorization is a process by which a server determines if the client
has permission to use a resource or access a file. Authorization is
usually coupled with authentication so that the server has some concept
of who the client is that is requesting access.}. It must not be
mistakenly used as
such\footnote{https://oauth.net/articles/authentication/ - Last visited
May 2, 2024}.
Services using OAuth 2.0 as base for the authentication mechanisms SHALL
do so according to the RFC 6749 \citep{std:RFC6749}.

Clients perform authentication with OAuth Bearer tokens using the
\emph{authorization} header. For example:

\begin{verbatim}
curl -H 'authorization: Bearer {token}' https://example.org/tap
< http/1.1 200
< x-vo-authenticated: {username}
\end{verbatim}

Interfaces using this mechanism SHOULD respond to a call to the
/capabilities endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_bearer
                    standard_id="ivo://ivoa.net/sso#OAuth"
                    access_url="https://example.org/login"
\end{verbatim}

\noindent and optionally, \textcolor{red}{MAY} be registered with the security
method

\texttt{ivo://ivoa.net/sso\#OAuth}


\subsubsection{Commentary}
Open Authentication 2.0 (also in conjunction with OpenID Connect) is
actually the adopted standard
to handle identity in the framework of RESTful web services.
OAuth 2.0 is used when an application is making a request on behalf of a
user.

OAuth 2.0 introduces the notion of  `authorization token',  `refresh
token' and Authorization Service (AS).
The `authorization' token states that the client application has the
right to access services on the server  (see Fig.~\ref{fig:oauth}).
However, it does not supersede any access control decisions that the
server-side application might make.

OAuth 2.0 protocol can be implemented  to delegate credential from an
application to another.

\subsection{Details on OpenID}
\subsubsection{Requirements}
OpenID Connect is an open standard that defines an
interoperable way to use OAuth 2.0 to perform user authentication.
Services using OpenID authentication mechanisms SHALL do so according to
the OpenID Foundation standards \citep{std:openid}

Interfaces using this mechanism SHOULD respond to a call to the
\emph{/capabilities} endpoint with an HTTP header with the basic form:
\begin{verbatim}
   www-authenticate: ivoa_openid
                    standard_id="ivo://ivoa.net/sso#OpenID"
                    access_url="https://example.org/login"
\end{verbatim}

\noindent and optionally, \textcolor{red}{MAY}  be registered with the security
method

\texttt{ivo://ivoa.net/sso\#OpenID}

\subsubsection{Commentary}
OpenID is an open and decentralized authentication and identity system.
OpenID relying parties do not manage end user credentials
such as passwords or any other sensitive information which makes
authentication and identity management much simpler and secure.
In a RESTful environment, OpenID Connect \citep{std:openidconnect} is
commonly adopted as authentication solution. ``OpenID Connect  is a
simple identity
layer on top of the OAuth 2.0 protocol, which allows computing clients
to verify the identity of an end-user based on the authentication
 performed by an authorization server, as well as to obtain basic
 profile information about the end-user in an interoperable and
 REST-like manner.'' \citep{std:openid}.

\section{Conclusions}
This document presents how to use existing security standards to make
IVOA compliant a service that requires authentication and how to
implement its clients.

\textcolor{red}{Editor's (Sara) note: all the remaining part of the
conclusions can be deleted. Not essential and, to introduce identity
federation and its use, we need some more thoughts, in my
opinion.}\todo{MD: Yeah, let's delete the entire section 5; it's a
unusual thing to have in an IVOA standard anyway.}

The presented IVOA-SSO protocols can be applied in two contexts:
``local'' and ``federated''.
Local SSO  provides solutions for keeping a repository of user-names
and passwords that could be used transparently across several internal
applications but it is local to one domain/service.

Federated identity means linking and using the electronic identities a
user has across several identity management systems.
In simpler terms, a service does not necessarily need to obtain and
store users credentials in order to authenticate them. Instead, the
service (or the application) can use an identity management system that
is already storing a user's electronic identity
to authenticate the users given, of course, that the application trusts
that identity management system.
Federated identities are convenient for users, since they don't have to
keep a set of user-names and passwords for every single application that
they use and for service providers that do not need to store and manage
credentials.

Local SSO is managed by  the following protocols: HTTP Basic
Authentication,  Transport Layer Security (TLS) with passwords, cookies
OAuth, SAML, OpenID and Transport Layer Security (TLS) with client
certificates (thanks to the CA trust) are protocol that
allow to implement  federated SSO.

The choice the authentication  to use is related to the project/service
requirements, we suggest at least to implement
a local authentication based on Transport Layer Security (TLS) with
passwords, that allows a reasonable security
framework for exchanging authentication tokens.

More complex projects/services that need to offer resources to large
communities should prefer federated identities.
For example SAML2.0 is the protocol used to build the EduGain World wide
identity federation  for education and research.

\textcolor{red}{Editor's (Sara) note: This appendix with the section
``VOResource  SecurityMethod'' could be deleted}

\appendix
\section{VOResource  SecurityMethod}
This Appendix presents an extract of the VOResource Description XML
schema. Here we present the part of the schema regarding the
\xmlel{SecurityMethod} element
to facilitate the reader identify the relevant schema sections in the
VOResource Description.

\begin{lstlisting}[language=xml,basicstyle=\footnotesize]
<xs:schema xmlns="http://www.w3.org/2001/XMLSchema"
xmlns:xs="http://www.w3.org/2001/XMLSchema"
xmlns:vr="http://www.ivoa.net/xml/VOResource/v1.0"
xmlns:vm="http://www.ivoa.net/xml/VOMetadata/v0.1"
targetNamespace="http://www.ivoa.net/xml/VOResource/v1.0"
elementFormDefault="unqualified" attributeFormDefault="unqualified" version="1.02">
<xs:annotation>...</xs:annotation>
<xs:simpleType name="UTCTimestamp">...</xs:simpleType>
<xs:simpleType name="UTCDateTime">...</xs:simpleType>
<xs:complexType name="Resource">...</xs:complexType>
<xs:simpleType name="ValidationLevel">...</xs:simpleType>
<xs:complexType name="Validation">...</xs:complexType>
<xs:simpleType name="AuthorityID">...</xs:simpleType>
<xs:simpleType name="ResourceKey">...</xs:simpleType>
<xs:simpleType name="IdentifierURI">...</xs:simpleType>
<xs:simpleType name="ShortName">...</xs:simpleType>
<xs:complexType name="Curation">...</xs:complexType>
<xs:complexType name="ResourceName">...</xs:complexType>
<xs:complexType name="Contact">...</xs:complexType>
<xs:complexType name="Creator">...</xs:complexType>
<xs:complexType name="Date">...</xs:complexType>
<xs:complexType name="Content">...</xs:complexType>
<xs:complexType name="Source">...</xs:complexType>
<xs:simpleType name="Type">...</xs:simpleType>
<xs:simpleType name="ContentLevel">...</xs:simpleType>
<xs:complexType name="Relationship">...</xs:complexType>
<xs:complexType name="Organisation">...</xs:complexType>
<xs:complexType name="Service">...</xs:complexType>
<xs:simpleType name="Rights">...</xs:simpleType>
<xs:complexType name="Capability">...</xs:complexType>
<xs:complexType name="Interface" abstract="true">
<xs:annotation>...</xs:annotation>
<xs:sequence>
   <xs:element name="accessURL" type="vr:AccessURL"
		minOccurs="1" maxOccurs="unbounded">...</xs:element>
   <xs:element name="securityMethod" type="vr:SecurityMethod"
		minOccurs="0" maxOccurs="unbounded">
      <xs:annotation>
          <xs:documentation> the mechanism the client must employ to
                                           gain secure access to the service.
         </xs:documentation>
          <xs:documentation> when more than one method is listed, each one
                                           must be employed to gain access.
         </xs:documentation>
      </xs:annotation>
    </xs:element>
</xs:sequence>
<xs:attribute name="version" type="xs:string" default="1.0">...</xs:attribute>
<xs:attribute name="role" type="xs:NMTOKEN">...</xs:attribute>
</xs:complexType>
<xs:complexType name="AccessURL">...</xs:complexType>
<xs:complexType name="SecurityMethod">
   <xs:annotation>
      <xs:documentation>a description of a security mechanism.</xs:documentation>
      <xs:documentation> this type only allows one to refer to the mechanism via a URI.
                                       Derived types would allow for more metadata.
     </xs:documentation>
   </xs:annotation>
<xs:sequence/>
<xs:attribute name="standardID" type="xs:anyURI">
   <xs:annotation>
      <xs:documentation> A URI identifier for a standard security mechanism. </xs:documentation>
      <xs:documentation>
            This provides a unique way to refer to a security specification standard.
            The use of an IVOA identifier here implies that a VOResource
            description of the standard is registered and accessible.
      </xs:documentation>
   </xs:annotation>
</xs:attribute>
</xs:complexType>
<xs:complexType name="WebBrowser">...</xs:complexType>
<xs:complexType name="WebService">...</xs:complexType>
</xs:schema>
\end{lstlisting}


\section{Changes from Previous Versions}

\subsection {Changes from v. 1.01}
\begin{itemize}
\item We remove all the references to SOAP as deprecated from IVOA
\item We add new security methods and relative discussion sessions:
	OpenID, SAML, Cookies, HTTP basic authentication
\end{itemize}

\textcolor{red}{Editor's (Sara) note: Need to be checked, probably more
detailed}

\subsection {Changes from v. 2.0}
\begin{itemize}
\item We describe a new bootstrapping authentication mechanism through
	a challenge-response authentication protocol.
\item We make optional the registration of the SecurityMethod also in
	case of ``authentication required''
\end{itemize}


\bibliography{ivoatex/ivoabib,ivoatex/docrepo,SSO}


\end{document}
